{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}
    Habilidades
{% endblock title %}

{% block content %}

    {% include "menu.html" %}

    <h2>üß† Habilidades</h2>

    <form method="get" class="my-3">
        <div class="row">
            <div class="col-12 col-md-9">

                <label class="form-label">Filtros:</label>

                <div class="input-group">

                    {# FILTRO POR N√çVEL #}
                    <select name="level" class="form-select">
                        <option value="">Todos N√≠veis</option>
                        {% for value, label in levels %}
                            <option value="{{ value }}"
                                {% if request.GET.level == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                        {% endfor %}
                    </select>

                    {# FILTRO POR TIPO DE SKILL #}
                    <select name="skill_type" class="form-select">
                        <option value="">Todos Tipos</option>
                        {% for value, label in skill_types %}
                            <option value="{{ value }}"
                                {% if request.GET.skill_type == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                        {% endfor %}
                    </select>

                    {# PESQUISA POR NOME #}
                    <input
                        type="text"
                        name="q"
                        value="{{ request.GET.q }}"
                        class="form-control"
                        placeholder="Habilidade"
                    >

                    <button class="btn btn-primary" type="submit">
                        <i class="bi bi-search"></i>
                    </button>

                    {# BOT√ÉO LIMPAR #}
                    {% if request.GET.q or request.GET.level or request.GET.skill_type %}
                        <a href="{% url 'profiles:habilidades_list' %}" class="btn btn-warning" title="Limpar filtros">
                            <i class="bi bi-x-lg"></i>
                        </a>
                    {% endif %}
                </div>

            </div>

            <div class="col-12 col-md-3 align-self-end text-sm-center text-md-end">
                <a class="btn btn-success" href="{% url 'profiles:habilidades_create' %}">
                    <i class="bi bi-window-plus"></i>
                    Novo
                </a>
            </div>
        </div>
    </form>

    {% if skills %}
        <div class="table-responsive">
            <table class="table table-sm align-middle table-striped table-hover">
                <thead>
                    <tr>
                        <th>Habilidade</th>
                        <th>Tipo</th>
                        <th>N√≠vel</th>
                        <th>Experi√™ncia (anos)</th>
                        <th class="text-end"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for skill in skills %}
                        <tr>
                            <td>{{ skill.skill.name }}</td>
                            <td>{{ skill.skill.get_skill_type_display }}</td>
                            <td>{{ skill.get_level_display }}</td>
                            <td>{{ skill.years_experience }}</td>

                            <td class="text-end">
                                <a class="btn btn-sm btn-info"
                                   href="{% url 'profiles:skill_detail' skill.pk %}"
                                   title="Detalhes">
                                    <i class="bi bi-search"></i>
                                </a>

                                <button class="btn btn-sm btn-danger"
                                        title="Excluir"
                                        data-bs-toggle="modal"
                                        data-bs-target="#delete-{{ skill.pk }}">
                                    <i class="bi bi-trash3"></i>
                                </button>
                            </td>
                        </tr>

                        {% include "skills/modal_delete.html" with skill=skill %}
                    {% empty %}
                        <tr>
                            <td colspan="5" class="text-muted text-center py-3">
                                Nenhuma habilidade cadastrada.
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    {% else %}
        <div class="text-center my-4">
            <div class="col-12 col-md-6 mx-auto">
                <div class="alert alert-info d-flex justify-content-center align-items-center gap-2" role="alert">
                    <span>Nenhuma habilidade cadastrada.</span>
                </div>
            </div>
        </div>
    {% endif %}

    {% include "pagination.html" %}

{% endblock content %}
